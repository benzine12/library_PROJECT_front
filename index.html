<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Book CRM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap CSS and Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Link to External CSS File -->
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>

  <nav class="navbar sidebar flex-column d-none d-md-flex">
    <a href="index.html" class="navbar-brand">
      <i class="fas fa-book-open"></i> Book CRM
    </a>
    <a href="index.html" class="nav-link active rounded-3">
      <i class="fas fa-home"></i> Home
    </a>
    <a href="customers.html" class="nav-link rounded-3">
      <i class="fas fa-user"></i> Customers
    </a>
    <a href="books.html" class="nav-link rounded-3">
      <i class="fas fa-book"></i> Books
    </a>
    <a href="loans.html" class="nav-link rounded-3">
      <i class="fas fa-hand-holding"></i> Loans
    </a>
    <a href="reports.html" class="nav-link rounded-3">
      <i class="fas fa-chart-line"></i> Reports
    </a>
  </nav>

  <!-- Offcanvas Sidebar for Mobile -->
  <nav class="navbar navbar-dark bg-dark d-md-none">
    <div class="container-fluid d-flex align-items-center justify-content-between">
      <!-- Sidebar Toggle Button -->
      <button class="navbar-toggler me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar"
        aria-controls="offcanvasSidebar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <!-- Navbar Brand -->
      <a class="navbar-brand mx-auto" href="index.html">
        <i class="fas fa-book-open"></i> Book CRM
      </a>
      <!-- Username and Photo -->
      <div class="d-flex align-items-center">
        <span>Hi, David</span>
        <img src="https://via.placeholder.com/40" class="rounded-circle ms-2" alt="User Image">
      </div>
    </div>
  </nav>

  <!-- Offcanvas Content -->
  <div class="offcanvas offcanvas-start bg-dark text-light" tabindex="-1" id="offcanvasSidebar"
    aria-labelledby="offcanvasSidebarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasSidebarLabel">
        <i class="fas fa-book-open"></i> Book CRM
      </h5>
      <button type="button" class="btn-close text-reset btn-close-white" data-bs-dismiss="offcanvas"
        aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <a href="index.html" class="nav-link active">
        <i class="fas fa-home"></i> Home
      </a>
      <a href="customers.html" class="nav-link">
        <i class="fas fa-user"></i> Customers
      </a>
      <a href="books.html" class="nav-link">
        <i class="fas fa-book"></i> Books
      </a>
      <a href="loans.html" class="nav-link">
        <i class="fas fa-hand-holding"></i> Loans
      </a>
      <a href="reports.html" class="nav-link">
        <i class="fas fa-chart-line"></i> Reports
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content">
    <div class="container-fluid">
      <div class="row align-items-center mb-4">
        <div class="col-md-8">
          <form class="d-flex">
            <input class="form-control me-2" type="search" placeholder="Search books, customers" aria-label="Search">
            <button class="btn btn-outline-light" type="submit">Search</button>
          </form>
        </div>
        <!-- Username and Photo for Desktop -->
        <div class="col-md-4 text-end d-none d-md-block">
          <span>Hi, David</span>
          <img src="https://via.placeholder.com/40" class="rounded-circle ms-2" alt="User Image">
        </div>
      </div>

      <!-- Carousel -->
      <div id="carouselExampleControls" class="carousel slide mb-4 " data-bs-ride="carousel">
        <div class="carousel-inner rounded-3">
          <!-- First Slide -->
          <div class="carousel-item active ">
            <img src="https://images.unsplash.com/photo-1521587760476-6c12a4b040da?q=80&w=2940&auto=format&fit=crop"
              class="d-block w-100" alt="Featured Book">
            <div class="carousel-caption d-none d-md-block custom-caption">
              <h5>Featured Book</h5>
              <p>Discover our latest collection.</p>
            </div>
          </div>

          <!-- Second Slide -->
          <div class="carousel-item">
            <img src="https://images.unsplash.com/photo-1532543307581-8b01a7ff954f?q=80&w=2370&auto=format&fit=crop"
              class="d-block w-100" alt="New Arrivals">
            <div class="carousel-caption d-none d-md-block custom-caption ">
              <h5>New Arrivals</h5>
              <p>Check out new books in stock.</p>
            </div>
          </div>

          <!-- Third Slide -->
          <div class="carousel-item">
            <img src="https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=2940&auto=format&fit=crop"
              class="d-block w-100" alt="Meet Our Team">
            <div class="carousel-caption d-none d-md-block custom-caption ">
              <h5>Meet Our Team</h5>
              <p>Our dedicated employees are here to help you find the perfect book.</p>
            </div>
          </div>
        </div>

        <!-- Carousel Controls -->
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
          data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>

        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
          data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>

      <!-- Active Cards -->
      <div class="row">
        <div class="col-md-4">
          <div class="card text-center p-3 mb-4" id="customers_num">
            <!-- Active Customers Count -->
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center p-3 mb-4" id="loans_num">
            <!-- Active Loans Count -->
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center p-3 mb-4" id="books_num">
            <!-- Active Books Count -->
          </div>
        </div>
      </div>

    </div>
  </div>
  <!-- Footer -->
  <footer class="footer py-3 text-center">
    <div class="container">
      <span>&copy; 2024 Book CRM</span> |
      <a href="#" class="text-light">Home</a> |
      <a href="#" class="text-light">About</a> |
      <a href="#" class="text-light">FAQ</a>
    </div>
  </footer>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Custom JS Script -->
  <script>
    const SERVER = 'http://127.0.0.1:5000';

    const get_customers = () => {
      axios(SERVER + "/customers")
        .then(res => {
          const activeCustomers = res.data.filter(customer => customer.is_active);
          customers_num.innerHTML = `<p class="mb-1">Active customers</p><h4>${activeCustomers.length}</h4>`;
        })
        .catch(error => console.error('Error fetching customers:', error));
    };

    const get_loans = () => {
      axios(SERVER + "/loans")
        .then(res => {
          const activeLoans = res.data.filter(loan => loan.is_active);
          loans_num.innerHTML = `<p class="mb-1">Active loans</p><h4>${activeLoans.length}</h4>`;
        })
        .catch(error => console.error('Error fetching loans:', error));
    };

    const get_books = () => {
      axios(SERVER + "/books")
        .then(res => {
          const activeBooks = res.data.filter(book => book.is_active);
          books_num.innerHTML = `<p class="mb-1">Active books</p><h4>${activeBooks.length}</h4>`;
        })
        .catch(error => console.error('Error fetching books:', error));
    };

    // Function to periodically refresh data
    const startAutoRefresh = () => {
      // Refresh every 5 seconds (5000 milliseconds)
      setInterval(() => {
        get_customers();
        get_loans();
        get_books();
      }, 5000);
    };

    // Initialize the dashboard and start auto-refresh
    get_customers();
    get_loans();
    get_books();
    startAutoRefresh();

  </script>

</body>

</html>